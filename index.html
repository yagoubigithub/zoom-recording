<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Live Audio Broadcast</title>
</head>
<body>
  <h1>Live Audio Broadcast</h1>
  <button id="start">Start Broadcast</button>

  <script>
    let audioContext;
    let socket;
    let mediaStream;

    // Start microphone capture and broadcast audio
    async function startBroadcast() {
      // Access microphone
      mediaStream = await navigator.mediaDevices.getUserMedia({ audio: true });
      
      audioContext = new (window.AudioContext || window.webkitAudioContext)();
      const source = audioContext.createMediaStreamSource(mediaStream);
      
      // Create WebSocket connection
      socket = new WebSocket('wss://zoom-recording-0uiz.onrender.com:4005');

      socket.onopen = () => {
        console.log('WebSocket connection established');

        // Capture audio data and send it via WebSocket
        const processor = audioContext.createScriptProcessor(2048, 1, 1);
        source.connect(processor);
        processor.connect(audioContext.destination);

        processor.onaudioprocess = function (e) {
          const audioData = e.inputBuffer.getChannelData(0);
          socket.send(audioData.buffer); // Send audio buffer to server
        };
      };

      // Handle incoming audio from other clients and play it
      socket.onmessage = function (event) {
        const arrayBuffer = event.data;

        audioContext.decodeAudioData(arrayBuffer, (buffer) => {
          const audioSource = audioContext.createBufferSource();
          audioSource.buffer = buffer;
          audioSource.connect(audioContext.destination);
          audioSource.start(0);
        });
      };
    }

    // Event listener for start button
    document.getElementById('start').addEventListener('click', startBroadcast);
  </script>
</body>
</html>
