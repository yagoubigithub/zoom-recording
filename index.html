<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>


    <script type="module">
        import { io } from "https://cdn.socket.io/4.7.5/socket.io.esm.min.js";



        let socket = io("https://zoom-recording-0uiz.onrender.com/", {
            transports: ['websocket'],
            upgrade: false
        });

        socket.on('connect', () => {
            navigator.mediaDevices.getUserMedia({ audio: true, video: false })
                .then((stream) => {
                    var madiaRecorder = new MediaRecorder(stream);
                    var audioChunks = [];

                    madiaRecorder.addEventListener("dataavailable", function (event) {
                        audioChunks.push(event.data);
                    });

                    madiaRecorder.addEventListener("stop", function () {
                        var audioBlob = new Blob(audioChunks);
                        audioChunks = [];
                        var fileReader = new FileReader();
                        fileReader.readAsDataURL(audioBlob);
                        fileReader.onloadend = function () {
                            var base64String = fileReader.result;
                            socket.emit("audioStream", base64String);
                        };

                        madiaRecorder.start();
                        setTimeout(function () {
                            madiaRecorder.stop();
                        }, 1000);
                    });

                    madiaRecorder.start();
                    setTimeout(function () {
                        madiaRecorder.stop();
                    }, 1000);
                })
                .catch((error) => {
                    console.error('Error capturing audio.', error);
                });
        });

        socket.on('audioStream', (audioData) => {
            var newData = audioData.split(";");
            newData[0] = "data:audio/ogg;";
            newData = newData[0] + newData[1];

            var audio = new Audio(newData);
            if (!audio || document.hidden) {
                return;
            }
            audio.play();
        });
    </script>


</body>

</html>